<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="Publication imported from Mendeley" >
    <Require feature="dynamic-height"/>
  </ModulePrefs> 
  <Content type="html">
     <![CDATA[ 
  <div id="publication_lists"></div>
  <script type="text/javascript">

  // This example fetches data from a CSV file containing contact information. In the CSV file, 
  // each record consists of a name, email address, and phone number.
  function getPublications() {
    var params = {};  
    params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;
    var url = "http://www.mendeley.com/profiles/asrul-hadi-yaacob/";
    gadgets.io.makeRequest(url, response, params);
  };
  // Callback function to process the response
  function response(obj) {
    var e = document.createElement('div');
    e.setAttribute('style', 'display: none;');
    e.innerHTML = obj.text;
    document.body.appendChild(e);
    pubs = document.getElementById("publications");
    // modified all the links 
    var pubsSection = [ "JournalArticle", "BookSection", "ConferenceProceedings" ];
    for (sec of pubsSection) {
      lists = document.getElementById(sec);
      for (j=0; j<lists.children.length; j++) {
        links = lists.children[j].getElementsByClassName("data")[0].getElementsByTagName("a") 
        // change the hostname
        links[0].hostname = "www.mendeley.com";
        links[0].target = "new";
        // also link in "Download PDF"
        for (l=1; l<links.length; l++) {
         if (links[l].text == "Download PDF") links[l].hostname = "www.mendeley.com";
        }
      }
    }
    pubsHTML = pubs.innerHTML;
    document.body.removeChild(e);

    var html = ""; 

    html += pubsHTML;

    html += "</div>";
    // Output html in div.
    document.getElementById('publication_lists').innerHTML = html;
    gadgets.window.adjustHeight();
  }
  gadgets.util.registerOnLoadHandler(getPublications);

 </script>
     ]]>
  </Content> 
</Module>

